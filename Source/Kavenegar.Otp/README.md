<div dir="rtl">
  
# استفاده از کتابخانه Kavenegar-otp

از این پروژه می‌توانید برای ارسال کد ورود دو مرحله‌ای (2FA) و تایید درست بودن کد وارد شده استفاده نمایید. برای ایجاد کد و تایید درست بودن کد از کتابخانه [Otp.NET](https://github.com/kspearrin/Otp.NET) و برای ارسال پیامک از کتابخانه [kavenegar-dotnet](https://github.com/kavenegar/kavenegar-dotnet) استفاده شده است.

## ویژگی‌های این کتابخانه:
1. بررسی تعداد تلاش‌های کاربر برای ارسال کد و جلوگیری از تلاش بیش از حد
2.  تنظیم حداکثر تعداد تلاش برای ارسال کد
3. بررسی تعداد دفعات وارد کردن کد اشتباه و جلوگیری از تلاش بیش از حد
4. قابلیت تنظیم میزان زمان قفل کردن درخواست‌های کاربر
5. پیاده‌سازی سرویس ارسال اعتبارسنجی کاوه نگار
6. استفاده از الگوریتم TOTP (Timed One-Time Password)
7. تنظیم تعداد شماره های کد 2FA
</div>

<div dir="rtl">

## برای شروع:
1. در پنل کاوه نگار یک الگوی اعتبارسنجی ایجاد نمایید. توجه نمایید که الگوی ایجاد شده فقط باید دارای یک `%token` باشد. [لینک صفحه ایجاد الگوی اعتبارسنجی](https://console.kavenegar.com/verification/create)
2. کتابخانه Kavenegar-otp را از طریق کد زیر به پروژه خود اضافه نمایید.
</div>

````
 dotnet add package Kavenegar.Otp --version 1.0.2
````
<div dir="rtl">
4. سرویس KavengearOtp را با استفاده از کد زیر در `Program.cs` وارد نمایید:
</div>


   ```csharp
   builder.Services.AddKavengearOtp(options =>
{
    // یک متن رندوم به عنوان رمز برنامه
    options.AppSecret = "yyKojENDkhytJW";
    
    // APIKEY کاوه نگار
    options.KavenegarApiKey = "6F47547424332554D6A4aAS654654ASDASD65444C5852673D";
    
    // حداکثر درخواست‌هایی که کاربر می‌تواند ارسال کد و کد اشتباه بفرستد
    options.MaxAttempts = 6;
    
    // زمان قفل شدن کاربر به دلیل وارد کردن کد اشتباه و یا ارسال کد
    options.LockoutDuration =  TimeSpan.FromMinutes(30);
    
    // نام الگو اعتبارسنجی
    options.KavenegarTemplateName = "LoginOtp";
    
    // طول کد 2FA
    options.OtpCodeLength = 8;
    
    // زمانی که کد 2FA معتبر است به ثانیه
    options.OtpLifeTime = 120;
});

   ```
<div dir="rtl">

5. برای ارسال پیامک کد 2FA از متد `SendOtp` استفاده نمایید. ورودی‌های این متد شامل "شماره موبایل" و "IP" می‌باشد.
6. برای بررسی صحیح بودن کد وارد شده توسط کاربر، از متد `VerifyOtp` استفاده نمایید که ورودی‌های این متد شامل "کد وارد شده توسط کاربر"، "IP" و "شماره موبایل" می‌باشد.
7. توجه داشته باشید که Exceptionهای تعریف شده در کتابخانه طبق جدول زیر استفاده نمایید:

    | خطا                              | توضیحات                                      | جزییات                    |
    |-------------------------------------|----------------------------------------------|-------------------------|
    | SendOtpException             | خطایی در ارسال پیامک رخ داده است | Code:کد خطای کاوه نگار <br /> Message: متن خطای کاوه نگار 
    |UserLockedException           | کاربر به دلیل تلاش بیش از حد قفل شده است| RemainingLockTime: زمان باقی مانده از قفل بود کاربر

</div>

